「計算機網絡」TCP報文結構
2019-08-31 由 代碼雜談 發表于程式開發


1、埠號：用來標識同一台計算機的不同的應用進程。


 
1）源埠：源埠和IP位址的作用是標識報文的返回地址。

2）目的埠：埠指明接收方計算機上的應用程式接口。

TCP報頭中的源埠號和目的埠號同IP數據報中的源IP與目的IP唯一確定一條TCP連接。

2、序號和確認號：是TCP可靠傳輸的關鍵部分。序號是本報文段發送的數據組的第一個字節的序號。在TCP傳送的流中，每一個字節一個序號。

3、數據偏移／首部長度：4bits。由於首部可能含有可選項內容，因此TCP報頭的長度是不確定的，報頭不包含任何任選欄位則長度為20字節，4位首部長度欄位所能表示的最大值為1111，轉化為10進位為15，15*32/8 = 60，故報頭最大長度為60字節。首部長度也叫數據偏移，是因為首部長度實際上指示了數據區在報文段中的起始偏移值。

4、保留：為將來定義新的用途保留，現在一般置0。



 
5、控制位：URG ACK PSH RST SYN FIN，共6個，每一個標誌位表示一個控制功能。

1）URG：緊急指針標誌，為1時表示緊急指針有效，為0則忽略緊急指針。

2）ACK：確認序號標誌，為1時表示確認號有效，為0表示報文中不含確認信息，忽略確認號欄位。

3）PSH：push標誌，為1表示是帶有push標誌的數據，指示接收方在接收到該報文段以後，應儘快將這個報文段交給應用程式，而不是在緩衝區排隊。

4）RST：重置連接標誌，用於重置由於主機崩潰或其他原因而出現錯誤的連接。或者用於拒絕非法的報文段和拒絕連接請求。

5）SYN：同步序號，用於建立連接過程，在連接請求中，SYN=1和ACK=0表示該數據段沒有使用捎帶的確認域，而連接應答捎帶一個確認，即SYN=1和ACK=1。

6）FIN：finish標誌，用於釋放連接，為1時表示發送方已經沒有數據發送了，即關閉本方數據流。

6、窗口：滑動窗口大小，用來告知發送端接受端的緩存大小，以此控制發送端發送數據的速率，從而達到流量控制。窗口大小時一個16bit欄位，因而窗口大小最大為65535。


 
7、校驗和：奇偶校驗，此校驗和是對整個的 TCP 報文段，包括 TCP 頭部和 TCP 數據，以 16 位字進行計算所得。由發送端計算和存儲，並由接收端進行驗證。

8、緊急指針：只有當 URG 標誌置 1 時緊急指針才有效。緊急指針是一個正的偏移量，和順序號欄位中的值相加表示緊急數據最後一個字節的序號。 TCP 的緊急方式是發送端向另一端發送緊急數據的一種方式。

9、選項和填充：最常見的可選欄位是最長報文大小，又稱為MSS（Maximum Segment Size），每個連接方通常都在通信的第一個報文段（為建立連接而設置SYN標誌為1的那個段）中指明這個選項，它表示本端所能接受的最大報文段的長度。選項長度不一定是32位的整數倍，所以要加填充位，即在這個欄位中加入額外的零，以保證TCP頭是32的整數倍。

10、數據部分： TCP 報文段中的數據部分是可選的。在一個連接建立和一個連接終止時，雙方交換的報文段僅有 TCP 首部。如果一方沒有數據要發送，也使用沒有任何數據的首部來確認收到的數據。在處理超時的許多情況中，也會發送不帶任何數據的報文段。